#!/usr/bin/make -f

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

%:
	dh $@

override_dh_auto_install:
	# Install executables
	install -D -m 755 cmd/map debian/functional-shell/usr/bin/map
	install -D -m 755 cmd/filter debian/functional-shell/usr/bin/filter
	
	# Install libraries
	mkdir -p debian/functional-shell/usr/lib/functional-shell
	cp -r lib/* debian/functional-shell/usr/lib/functional-shell/
	
	# Install shell completions
	install -D -m 644 scripts/completion/bash_completion \
		debian/functional-shell/usr/share/bash-completion/completions/functional-shell
	
	# Install documentation
	install -D -m 644 docs/installation.md \
		debian/functional-shell/usr/share/doc/functional-shell/installation.md
	install -D -m 644 docs/usage/basic-usage.md \
		debian/functional-shell/usr/share/doc/functional-shell/basic-usage.md
	install -D -m 644 docs/reference/operations.md \
		debian/functional-shell/usr/share/doc/functional-shell/operations.md

override_dh_auto_test:
	# Run basic smoke tests
	./cmd/map --version
	./cmd/filter --version
	echo "test" | ./cmd/map to_upper | grep -q "TEST"
	echo -e "1\n2\n3" | ./cmd/filter odd | grep -q "1"